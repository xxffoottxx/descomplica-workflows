<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="WA Dash">
    <title>WhatsApp Dashboard - Descomplicador</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- API Key Prompt -->
    <div id="api-key-prompt" class="modal" style="display: none;">
        <div class="modal-content">
            <div style="text-align:center;margin-bottom:20px">
                <img src="https://descomplicador.pt/images/logo-footer.png" alt="Descomplicador" style="height:32px;width:auto">
            </div>
            <h2>Autentica&ccedil;&atilde;o</h2>
            <p>Insira a chave de API para aceder ao dashboard:</p>
            <input type="password" id="api-key-input" placeholder="Chave de API" aria-label="Chave de API">
            <button id="save-api-key" class="btn-primary">Guardar</button>
        </div>
    </div>

    <!-- Connection Error Banner -->
    <div id="connection-banner" class="connection-banner" style="display: none;" role="alert">
        Erro de liga&ccedil;&atilde;o. A tentar reconectar...
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <!-- Loading Spinner -->
    <div id="loading" class="loading" style="display: none;" aria-label="A carregar">
        <div class="spinner"></div>
    </div>

    <!-- Conversation List View -->
    <div id="list-view" class="view">
        <header class="header">
            <img src="https://descomplicador.pt/images/logo-footer.png" alt="Descomplicador" class="header-logo">
            <h1>WhatsApp Dashboard</h1>
            <button id="refresh-btn" class="icon-btn" aria-label="Atualizar">
                <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
                    <path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                </svg>
            </button>
        </header>
        <div id="bot-control-bar" class="bot-control-bar">
            <div class="bot-control-left">
                <span id="bot-status-indicator" class="bot-status-indicator on"></span>
                <span id="bot-status-text" class="bot-status-text">Assistente ativo</span>
            </div>
            <div class="bot-control-right">
                <button id="settings-btn" class="bot-schedule-btn" aria-label="HorÃ¡rio">
                    <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                        <path fill="currentColor" d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                    </svg>
                    <span id="schedule-label">Sempre</span>
                </button>
                <label class="toggle">
                    <input type="checkbox" id="bot-enabled-toggle" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
        <div id="conversations-container" class="conversations-container">
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal" style="display: none;">
        <div class="modal-content settings-content">
            <div class="settings-header">
                <h2>Hor&aacute;rio do Assistente</h2>
                <button id="settings-close" class="icon-btn" aria-label="Fechar">
                    <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
                        <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="settings-section">
                <p class="settings-hint">O assistente s&oacute; responde dentro deste hor&aacute;rio. Sem hor&aacute;rio = sempre ativo.</p>
                <div id="schedule-rules"></div>
                <button id="add-schedule-rule" class="btn-add-rule">+ Adicionar regra</button>
            </div>
            <button id="save-settings" class="btn-primary">Guardar</button>
        </div>
    </div>

    <!-- Chat Thread View -->
    <div id="chat-view" class="view" style="display: none;">
        <header class="header chat-header">
            <button id="back-btn" class="icon-btn" aria-label="Voltar">
                <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
                    <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
            </button>
            <div class="chat-header-info">
                <div class="avatar" id="chat-avatar"></div>
                <div class="chat-header-text">
                    <h2 id="chat-name"></h2>
                    <p id="chat-phone"></p>
                </div>
            </div>
            <button id="takeover-btn" class="takeover-btn" aria-label="Assumir conversa">
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                    <path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                <span id="takeover-label">Assumir</span>
            </button>
        </header>
        <div id="window-warning" class="window-warning" style="display:none;" role="alert">
            <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                <path fill="currentColor" d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
            </svg>
            <span>Janela de 24h expirada. Enviar mensagens pode ter custos adicionais.</span>
        </div>
        <div id="messages-container" class="messages-container" aria-live="polite" aria-label="Mensagens">
        </div>
        <div class="reply-bar">
            <input
                type="text"
                id="reply-input"
                placeholder="Escreva uma resposta..."
                autocomplete="off"
                aria-label="Escreva uma resposta"
                maxlength="4096"
            >
            <button id="send-btn" class="send-btn" aria-label="Enviar">
                <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
                    <path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                </svg>
            </button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
